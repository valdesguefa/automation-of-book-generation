from django.shortcuts import render
from io import BytesIO
from django.http import HttpResponse
from django.template.loader import get_template
from django.views import View
from xhtml2pdf import pisa

# Create your views here.

def render_to_pdf(template_src, context_dict = {}) :
    template = get_template(template_src)
    html = template.render(context_dict)

    result = BytesIO()
    pdf = pisa.pisaDocument(BytesIO(html.encode("UTF-8")), result)
    if not pdf.err :
        return HttpResponse(result.getvalue(), content_type='application/pdf')
    
    return None


data = {
    "titre": "Le rêveur",
    "chapitres": [
        {
            "titre": "Le début d'un rêve",
            "contenu": {
                "paragraphes": [
                    "Il était une fois, un jeune homme nommé Max. Il était passionné par l'informatique et rêvait de changer le monde avec ses amis. Max était convaincu que la technologie pouvait aider les gens et améliorer leur vie.",
                    "Un jour, Max a eu une idée révolutionnaire. Il voulait créer une application pour aider les personnes âgées à trouver des aides-soignants et des compagnons. Max a rassemblé ses amis et a commencé à travailler sur l'application. Ils ont travaillé dur, jour et nuit.",
                    "Après plusieurs mois de travail acharné, l'application était prête. Max et ses amis étaient fiers de leur création et ont commencé à la promouvoir auprès des personnes âgées. L'application a été un succès immédiat et a aidé de nombreuses personnes à trouver des aides-soignants et des compagnons."
                ]
            },
            "resume": "Max rêve de changer le monde avec l'informatique et a une idée révolutionnaire pour aider les personnes âgées.",
            "image": "https://oaidalleapiprodscus.blob.core.windows.net/private/org-X4riREet5Vfcd6r39RXEaboh/user-ialq0uLckvMaQtaUh3EszH6z/img-msCXAlL1IyGEvnSdPygkEmIG.png?st=2023-03-30T08%3A29%3A25Z&se=2023-03-30T10%3A29%3A25Z&sp=r&sv=2021-08-06&sr=b&rscd=inline&rsct=image/png&skoid=6aaadede-4fb3-4698-a8f6-684d7786b067&sktid=a48cca56-e6da-484e-a814-9c849652bcb3&skt=2023-03-30T09%3A26%3A54Z&ske=2023-03-31T09%3A26%3A54Z&sks=b&skv=2021-08-06&sig=yjBkmVLFQE2xlrlfOIOVKBeB2VZwCzREwhp7F81swnM%3D"
        },
        {
            "titre": "Les obstacles sur le chemin",
            "contenu": {
                "paragraphes": [
                    "Cependant, Max et ses amis ont rencontré des obstacles sur leur chemin. Ils ont dû faire face à des critiques et des sceptiques qui ne croyaient pas en leur idée. Certaines personnes ont même essayé de les décourager.",
                    "Mais Max et ses amis ont persévéré. Ils ont travaillé dur pour améliorer l'application et ont continué à promouvoir leur idée. Finalement, leurs efforts ont été récompensés et l'application est devenue de plus en plus populaire.",
                    "Malgré les difficultés, Max et ses amis ont continué à rêver. Ils ont commencé à travailler sur de nouvelles idées pour aider les gens grâce à la technologie. Ils ont réalisé que leur rêve de changer le monde était possible s'ils travaillaient ensemble et ne renonçaient jamais."
                ]
            },
            "resume": "Max et ses amis ont fait face à des obstacles mais ont persévéré grâce à leur rêve commun.",
            "image": "https://oaidalleapiprodscus.blob.core.windows.net/private/org-X4riREet5Vfcd6r39RXEaboh/user-ialq0uLckvMaQtaUh3EszH6z/img-UMqVKwwQraNBx2Aru1dY8ji9.png?st=2023-03-30T08%3A29%3A33Z&se=2023-03-30T10%3A29%3A33Z&sp=r&sv=2021-08-06&sr=b&rscd=inline&rsct=image/png&skoid=6aaadede-4fb3-4698-a8f6-684d7786b067&sktid=a48cca56-e6da-484e-a814-9c849652bcb3&skt=2023-03-30T09%3A28%3A38Z&ske=2023-03-31T09%3A28%3A38Z&sks=b&skv=2021-08-06&sig=cF4DHYnb8yX1GT3vcPlI56h67TBt2oy68Vyyif78Wlo%3D"
        },
        {
            "titre": "La réalisation du rêve",
            "contenu": {
                "paragraphes": [
                    "Finalement, le rêve de Max est devenu réalité. L'application qu'il avait créée pour aider les personnes âgées est devenue une entreprise prospère. Max et ses amis ont travaillé dur pour la faire grandir et l'étendre à d'autres domaines.",
                    "Ils ont créé des applications pour aider les personnes à mobilité réduite à trouver des moyens de transport accessibles et pour aider les enfants à apprendre à lire. Leurs idées ont changé la vie de nombreuses personnes et ont inspiré d'autres à faire de même.",
                    "Max et ses amis ont réalisé leur rêve de changer le monde grâce à l'informatique. Ils ont prouvé que tout est possible si l'on croit en soi et si l'on travaille dur pour réaliser ses rêves."
                ]
            },
            "resume": "Le rêve de Max est devenu réalité grâce à son travail acharné et à sa persévérance.",
            "image": "https://oaidalleapiprodscus.blob.core.windows.net/private/org-X4riREet5Vfcd6r39RXEaboh/user-ialq0uLckvMaQtaUh3EszH6z/img-05j9pmzbmgqhBvZi5dDCvvGw.png?st=2023-03-30T08%3A29%3A39Z&se=2023-03-30T10%3A29%3A39Z&sp=r&sv=2021-08-06&sr=b&rscd=inline&rsct=image/png&skoid=6aaadede-4fb3-4698-a8f6-684d7786b067&sktid=a48cca56-e6da-484e-a814-9c849652bcb3&skt=2023-03-30T09%3A25%3A05Z&ske=2023-03-31T09%3A25%3A05Z&sks=b&skv=2021-08-06&sig=m1O2KHtE%2BJeURqunQmi8NEaSnbUHALlOFt7ZL6ykw1U%3D"
        }
    ]
}


class ViewPDF(View) :
    def get(self, request, *args, **kwargs) :
        pdf = render_to_pdf('app/report.html', data)
        return HttpResponse(pdf, content_type = 'application/pdf')

class DownloadPDF(View) :
    def get(self, request, *args, **kwargs) :
        pdf = render_to_pdf('app/sample.html')
        reponse = HttpResponse(pdf, content_type = 'application/pdf')
        filename = "sample_%s.pdf"%("12345678")
        content = "attachment; filename='%s'"%(filename)
        reponse['content-Disposition'] = content

        return reponse

def index(request) :
    context = {}
    return render(request, 'app/index.html', context)